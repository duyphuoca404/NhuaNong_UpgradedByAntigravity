<UserControl x:Class="NhuaNong.Wpf.UserControls.SiloControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:NhuaNong.Wpf.UserControls"
             xmlns:converters="clr-namespace:NhuaNong.Wpf.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="200" d:DesignWidth="80">
    <UserControl.Resources>
        <converters:SiloColorConverter x:Key="SiloColorConverter"/>
        <converters:LevelHeightConverter x:Key="LevelHeightConverter"/>
    </UserControl.Resources>
    
    <Grid>
        <!-- Silo Body (Cylinder + Cone) -->
        <!-- Silo Image -->
        <Image Stretch="Fill">
            <Image.Style>
                <Style TargetType="Image">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding SiloType}" Value="AGG">
                            <Setter Property="Source" Value="/Assets/Images/_silo_AGG.png"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding SiloType}" Value="FD">
                            <Setter Property="Source" Value="/Assets/Images/_silo_FD.png"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding SiloType}" Value="SBS">
                            <Setter Property="Source" Value="/Assets/Images/_silo_SBS.png"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding SiloType}" Value="AP">
                            <Setter Property="Source" Value="/Assets/Images/_silo_AP.png"/>
                        </DataTrigger>
                        <!-- Default fallback -->
                         <DataTrigger Binding="{Binding SiloType}" Value="{x:Null}">
                            <Setter Property="Source" Value="/Assets/Images/_silo_AGG.png"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Image.Style>
        </Image>

        <!-- Horizontal Ribs (Decoration) -->


        <!-- Level Indicator (Bar) -->
        <Border Width="10" Height="120" Background="Black" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,10,5,0" BorderBrush="Gray" BorderThickness="1">
            <Grid>
                <!-- Level Fill -->
                <Rectangle Fill="#FF00FF00" VerticalAlignment="Bottom">
                    <Rectangle.Height>
                        <MultiBinding Converter="{StaticResource LevelHeightConverter}">
                            <Binding Path="Actual"/>
                            <Binding Path="Setpoint"/> <!-- Assuming Max Capacity or similar, using Setpoint for now as placeholder -->
                        </MultiBinding>
                    </Rectangle.Height>
                </Rectangle>
            </Grid>
        </Border>

        <!-- Info Box (Name) -->
        <Border Background="Black" BorderBrush="Gray" BorderThickness="1" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,-40,0,0" Padding="5,2">
            <TextBlock Text="{Binding Caption}" Foreground="White" FontWeight="Bold" FontSize="10"/>
        </Border>

        <!-- Info Box (Value) -->
        <Border Background="Black" BorderBrush="Gray" BorderThickness="1" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,20,0,0" Padding="5,2">
            <TextBlock Text="{Binding Actual}" Foreground="Yellow" FontWeight="Bold" FontSize="10"/>
        </Border>

        <!-- Valve Indicator (Triangle) -->
        <Path Data="M 30,205 L 50,205 L 40,220 Z" Fill="Red" Stroke="Black" StrokeThickness="1" VerticalAlignment="Bottom" Margin="0,0,0,-20"/>

    </Grid>
</UserControl>
